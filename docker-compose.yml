version: '3.8'

services:
  api:
    build: .
    ports:
      - "${API_PORT:-8000}:${API_PORT:-8000}"
    environment:
      # Copernicus Marine credentials (required for data download)
      - COPERNICUSMARINE_USERNAME=${COPERNICUSMARINE_USERNAME}
      - COPERNICUSMARINE_PASSWORD=${COPERNICUSMARINE_PASSWORD}
      # API port (configurable)
      - API_PORT=${API_PORT:-8000}
      # Use local Zarr files instead of remote
      - USE_LOCAL_ZARR=true
      - APP_ZARR_DIR=/app/data/zarr
    volumes:
      # Persist downloaded data between container restarts
      - ./data/zarr:/app/data/zarr
    # Memory limits: increase if download fails with "Killed" error
    # Uncomment and adjust these lines if needed:
    # mem_limit: 4g
    # memswap_limit: 4g
    restart: unless-stopped

